# Лабораторная работа №3

Для выполнения этой лабораторной работы я выбрала свой пет-проект на html, css и js без серверной части - [веб-приложение todo-list](https://todolistpixelapp.vercel.app/)

Репозиторий проекта: https://github.com/a-orlova/todolist_web

Основные функции приложения следующие:
1. добавление новой задачи в список с датой (инпут type="text" + type="date")
2. отметка задачи как выполненной (чекбокс)
3. редактирование задачи (открытие формы, сохранение или отмена)
4. удаление одной задачи
5. удаление всех задач (подтверждается через confirm)
6. поиск по имени задачи
7. фильтрация по выполненности
8. сортировка по дате
9. перетаскивание задач для изменения порядка (через drag & drop)
10. сохранение и загрузка задач через localStorage

## Анализ пользовательских сценариев

Ключевые пользовательские пути опираются на существующие функции, перечисленные выше, поэтому можно описать их так:

1. добавление новой задачи: пользователь вводит текст в поле task, по желанию выбирает дату, нажимает кнопку add - ожидается появляение задачи в списке с введенным текстом и датой, сохранение ее в localStorage, увеличение счетчика тотал и скрывание сообщения о том, что задач нет
2. отметка выполнения задачи - нажимается чекбокс задачи - ожидается визуальное изменение задачи в списке (зачеркнутый текст и картинка чекбокса), поле completed в объекте задачи toggled, опять же изменения сохраняются в localStorage
3. редактирование задачи - задача существует и пользователь нажимает значок edit у задачи, вносит изменения в форме редактирования, нажимает save или cancel - при сохранении ожидается применение изменений, обновление localStorage и снова отображение списка, а при удалении - изменения не сохраняются, форма скрывается и список тоже снова видно
4. удаление одной задачи - задача есть, пользователь нажимает кнопку удалить - ожидается удаление задачи из dom и tasks массива, обновление localStorage, счетчик уменьшается, также если задач больше нет снова появляется пустое сообщение
5. удаление всех задач - аналогично предыдущему, но удаляются все задачи, и точно появляется пустое сообщение
6. поиск задачи - если есть задачи с разными названиями, то при вводе в поле поиска какой-то подстроки список показывает только те задачи, в имени которых ест это подстрока
7. фильтрация - при нажатии на кнопку фильтра по очереди переключается режим отображения списка, отображается соответствующее подмножество задач, то есть либо все выполненные, все невыполненные и просто весь список
8. сортировка по дате - при нажатии на кнопку sort by date ожидается переставление задач в нужном порядке по возрастанию даты, при нажатии еще раз - возвращается исходный порядок
9. перетаскивание - если есть 2 или больше задач, то при нажатии на любую ее можно перенести в другое место в списке с помощью мыши, ожидается визуальное изменени порядка и обновление внутреннего массива tasks
10. сохранение задач при перезагрузке страницы - если перезагрузить страницу список задач должен восстановиться в localStorage в предыдущем своем состоянии

Если говорить о граничных случаях или возможных ошибках, которые стоит покрыть тестами, то я предположила следующие:

1. при пустом вводе или только вводе пробелов новая задача должна не добавляться
2. проверка на максимальну длину или очень длинный текст - надо понять как реагирует приложение и ломается ли при том интерфейс, ожидается, что нет
3. должны быть разрешены дубликаты задач и появляются отдельно
4. пустая дата - если пользователь дату не вводит, то должна автоматически указываться текущая дата
5. редактирование с пустым именем - по факту если при редактировании указать пустое имя у задачи, она не должна сохраняться пустой, должна вылезать ошибка

## Ход работы

Я протестировала не все пользовательские пути, которые описала выше, а только самые основные + граничные случаи. 

```
it('должен добавлять задачу и сохранять её после перезагрузки', () => {
    const taskName = 'Купить хлеб';
    const taskDate = '2025-11-10';

    cy.get('input[name="task"]').type(taskName);
    cy.get('input[name="date"]').type(taskDate);
    cy.get('.btn--add').click();

    cy.get('#tasks-container li.task')
      .should('have.length', 1)
      .first()
      .within(() => {
        cy.get('.task__name').should('have.text', taskName);
        cy.get('.task__date').should('contain', '10.11.2025');
      });

    cy.reload();
    cy.get('#tasks-container li.task .task__name').should('contain', taskName);
  });
```
- Пользователь добавляет задачу с названием и датой, после обновления страницы задача должна сохраняться.
Тест проверяет корректное сохранение данных в localStorage и правильное отображение задач после перезагрузки

```
it('удаляет все задачи при подтверждении', () => {

    ['A', 'B'].forEach(task => {
      cy.get('input[name="task"]').type(task);
      cy.get('.btn--add').click();
    });
    cy.get('#tasks-container li.task').should('have.length', 2);

    cy.window().then((win) => {
      cy.stub(win, 'confirm').returns(true);
    });

    cy.get('.btn--delete-all').click();

    cy.get('#tasks-container .task').should('have.length', 0);
    cy.get('#task-count').should('contain', '0');
    
    cy.get('.todo__empty').should('be.visible');
    cy.get('.todo__empty p').should('contain', "u don't have any tasks yet :(");

    cy.window().then((win) => {
      const tasks = JSON.parse(win.localStorage.getItem('tasks') || '[]');
      expect(tasks).to.have.length(0);
    });
  });
```
- Пользователь нажимает кнопку «удалить все» и подтверждает действие через confirm, все задачи должны быть удалены.
Тест проверяет работу массового удаления задач и правильное обновление интерфейса
  
```
  it('не удаляет задачи, если пользоватль отменил', () => {

    ['A', 'B'].forEach(task => {
      cy.get('input[name="task"]').type(task);
      cy.get('.btn--add').click();
    });
    cy.get('#tasks-container li.task').should('have.length', 2);

    cy.window().then((win) => {
      cy.stub(win, 'confirm').returns(false);
    });

    cy.get('.btn--delete-all').click();

    cy.get('#tasks-container .task').should('have.length', 2);
    cy.get('#task-count').should('contain', '2');
    
    cy.get('.todo__empty').should('not.be.visible');

    cy.window().then((win) => {
      const tasks = JSON.parse(win.localStorage.getItem('tasks') || '[]');
      expect(tasks).to.have.length(2);
    });
  });
```
- Пользователь нажимает кнопку «удалить все», но отменяет действие в диалоге подтверждения, задачи должны остаться.
Тест проверяет корректность работы механизма отмены удаления и сохранение данных при отказе пользователя.

```
  it('должен позволять редактировать задачу и сохранять изменения', () => {
    cy.get('input[name="task"]').type('Почитать книгу');
    cy.get('.btn--add').click();

    cy.get('.task__name').should('contain', 'Почитать книгу');

    cy.get('.btn--edit').click();

    cy.get('section.todo__edit').should('be.visible');

    cy.get('#edit-form input[type="text"]').clear().type('Почитать 2 главы');

    cy.get('.btn--save').click();

    cy.get('.task__name').should('contain', 'Почитать 2 главы');

    cy.get('section.todo__edit').should('not.be.visible');
  });
```
- Пользователь редактирует название задачи и сохраняет изменения.
Тест проверяет возможность модификации задач, корректное обновление localStorage и интерфейса.

```
  it('не должен добавлять задачу при пустом вводе или только пробелах', () => {
    cy.get('input[name="task"]').clear().type('   ');
    cy.get('.btn--add').click();
    cy.get('#tasks-container li.task').should('have.length', 0);
  });
```
- Пользователь пытается добавить пустую задачу.
Тест проверяет валидацию ввода, предотвращение создания пустых задач, что важно для поддержания корректности данных.

```
  it('должен корректно отображать и не ломать интерфейс при длинном тексте', () => {
    const longText = 'X'.repeat(1000);
    cy.get('input[name="task"]').type(longText);
    cy.get('.btn--add').click();

    cy.get('#tasks-container li.task')
      .should('have.length', 1)
      .and('be.visible')
      .within(() => {
        cy.get('.task__name')
          .should('contain', 'XXXXX')
          .invoke('text')
          .should('have.length.at.least', 100);
      });
  });
```
- Пользователь вводит максимально длинный текст - 1000 символов.
Тест проверяет устойчивость интерфейса к большим значениям и предотвращение поломки отображения.

```
  it('должен разрешать дублирующиеся задачи', () => {
    cy.get('input[name="task"]').type('Помыть посуду');
    cy.get('.btn--add').click();
    cy.get('input[name="task"]').type('Помыть посуду');
    cy.get('.btn--add').click();

    cy.get('#tasks-container li.task')
      .should('have.length', 2)
      .each($el => cy.wrap($el).contains('Помыть посуду'));
  });
```
- Пользователь добавляет задачи с одинаковыми названиями.
Тест проверяет поддержку дубликатов, что может быть допустимым поведением в списке задач.

```
  it('при пустой дате автоматически должна проставляться текущая', () => {
    const today = new Date().toLocaleDateString('ru-RU');
    cy.get('input[name="task"]').type('Без даты');
    cy.get('.btn--add').click();

    cy.get('#tasks-container .task__date').should('contain', today);
  });
```
- Пользователь не указывает дату задачи.
Тест проверяет, что система корректно проставляет текущую дату по умолчанию

```
  it('не должен сохранять пустое имя', () => {
    cy.get('input[name="task"]').type('Проверка пустого имени');
    cy.get('.btn--add').click();

    cy.get('.btn--edit').click();

    cy.get('section.todo__edit').should('be.visible');

    cy.get('#edit-form input[type="text"]').clear();

    cy.on('window:alert', (txt) => {
      expect(txt).to.contains('Название задачи не может быть пустым!');
    });

    cy.get('.btn--save').click();

    cy.get('section.todo__edit').should('be.visible');

    cy.get('.task__name').should('contain', 'Проверка пустого имени');
  });
```
- Пользователь пытается сохранить пустое название задачи, должна появляться ошибка, изменения не сохраняются.
Тест проверяет валидацию редактирования и предотвращение некорректных данных.

## Результаты тестов

Из 9 написанных мною тестов успешных всего 7. Мое приложение не прошло 2 теста - проверка на поломку интерфейса при очень длинном тексте и проверка на сохранение пустого имени после редактирования

<img width="2558" height="1009" alt="image" src="https://github.com/user-attachments/assets/024475f5-deae-499a-9114-3b435a6988b2" />

Первый тест не прошел из-за ошибки в css стилях, то есть провал именно в визуальной части. Чтобы его решить можно просто добавить обрезку текста или перенос по словам

<img width="1119" height="817" alt="image" src="https://github.com/user-attachments/assets/ceb54edb-3cb5-41c6-9db1-a45ea9fe8fc3" />

Второй тест я тоже ожидала что не пройдет, потому что этот момент действительно в коде не прописан - по тесту форма редактирования не должна закрываться если поле с именем пустое, а она закрылась и в итоге появляется пустая задача. Проблема решается добавлением проверки на пустое имя

<img width="1127" height="988" alt="image" src="https://github.com/user-attachments/assets/6aa61d22-32f1-40f3-a16d-4dc14edb7e03" />

## Выводы

Приложение корректно выполняет базовые функции — добавление, редактирование, удаление задач, хранение данных в localStorage. Большинство пользовательских сценариев реализованы стабильно, но обнаружилась явная проблема с ux - при вводе очень длинного текста интерфейс ломается — задача выходит за пределы контейнера, что ухудшает восприятие и может запутать пользователя.Также при редактировании задачи пустое имя сохраняется некорректно — отсутствует явное уведомление, что название задачи не может быть пустым.

В итоге благодаря тестированию стало понятно, какие улучшения можно добавить - исправить обработку длинного текста через перенос, обрезку или скролл и добавить проверку на пустое имя при редактировании с уведомлением об ошибке
